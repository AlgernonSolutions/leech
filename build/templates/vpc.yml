AWSTemplateFormatVersion: 2010-09-09
Transform:
  - 'AWS::Serverless-2016-10-31'
  - 'AWS::CodeStar'
Parameters:
  VpcCidr:
    Type: String
    Description: Cidr Block of VPC
    Default: 192.168.0.0/16
  FirstSubnetCidr:
    Type: String
    Description: Cidr Block of First Created Subnet
    Default: 192.168.1.0/24
  SecondSubnetCidr:
    Type: String
    Description: Cidr Block of Second Created Subnet
    Default: 192.168.2.0/24
  ThirdSubnetCidr:
    Type: String
    Description: Cidr Block of Third Created Subnet
    Default: 192.168.3.0/24
Resources:
  Vpc:
    Type: 'AWS::EC2::VPC'
    Properties:
      CidrBlock: !Ref VpcCidr
    Metadata:
      'AWS::CloudFormation::Designer':
        id: f309f1b9-ac09-4838-b8df-72a9c3a235f7
  FirstSubnet:
      Type: 'AWS::EC2::Subnet'
      Properties:
        VpcId: !Ref Vpc
        CidrBlock: !Ref FirstSubnetCidr
      Metadata:
        'AWS::CloudFormation::Designer':
          id: e94f82fc-27a5-4f3f-9c8c-9928247992fa
  SecondSubnet:
      Type: 'AWS::EC2::Subnet'
      Properties:
        VpcId: !Ref Vpc
        CidrBlock: !Ref SecondSubnetCidr
      Metadata:
        'AWS::CloudFormation::Designer':
          id: 9fc65d22-2218-4ef3-b93b-6607326e5553
  ThirdSubnet:
      Type: 'AWS::EC2::Subnet'
      Properties:
        VpcId: !Ref Vpc
        CidrBlock: !Ref ThirdSubnetCidr
      Metadata:
        'AWS::CloudFormation::Designer':
          id: ccda3246-4d55-4c4e-a19e-fe933db6e970
  RouteTable:
      Type: 'AWS::EC2::RouteTable'
      Properties:
        VpcId: !Ref Vpc
      Metadata:
        'AWS::CloudFormation::Designer':
          id: 524fd573-66dd-45a5-a3e4-65291313a8e4
  InternetRoute:
      Type: 'AWS::EC2::Route'
      Properties:
        RouteTableId: !Ref RouteTable
        DestinationCidrBlock: 0.0.0.0/0
        GatewayId: !Ref InternetGateway
      DependsOn:
        - InternetGateway
      Metadata:
        'AWS::CloudFormation::Designer':
          id: c664d9a9-f402-44a6-a8f3-9a91d8c74d6f
  EC2SRTA429KF:
      Type: 'AWS::EC2::SubnetRouteTableAssociation'
      Properties:
        RouteTableId: !Ref RouteTable
        SubnetId: !Ref ThirdSubnet
      Metadata:
        'AWS::CloudFormation::Designer':
          id: bfeaedd8-f016-4f9f-8705-9e22cd96087a
  EC2SRTA1MF09:
      Type: 'AWS::EC2::SubnetRouteTableAssociation'
      Properties:
        SubnetId: !Ref SecondSubnet
        RouteTableId: !Ref RouteTable
      Metadata:
        'AWS::CloudFormation::Designer':
          id: ad6d614b-501c-4d27-b37d-df90508796bc
  EC2SRTA1HJ1H:
      Type: 'AWS::EC2::SubnetRouteTableAssociation'
      Properties:
        RouteTableId: !Ref RouteTable
        SubnetId: !Ref FirstSubnet
      Metadata:
        'AWS::CloudFormation::Designer':
          id: 2b0e5325-4e37-4ca4-96c8-e5bd8a48733b
  InternetGateway:
      Type: 'AWS::EC2::InternetGateway'
      Properties: {}
      Metadata:
        'AWS::CloudFormation::Designer':
          id: 19b59139-9f62-4417-b20e-a94c1389ff0a
  IgwAttach:
      Type: 'AWS::EC2::VPCGatewayAttachment'
      Properties:
        InternetGatewayId: !Ref InternetGateway
        VpcId: !Ref Vpc
      Metadata:
        'AWS::CloudFormation::Designer':
          id: aaa7ed66-f911-4519-ac02-74db02992655
  LambdaSg:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupName: LambdaSg
      GroupDescription: security group allowing lambda functions access to VPC resources
      VpcId: !Ref Vpc
      SecurityGroupIngress:
        - IpProtocol: -1
          FromPort: -1
          ToPort: -1
          CidrIp: !Ref VpcCidr
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 536193f1-c349-490a-a47d-e299dfa64ea5
Outputs:
  VpcId:
    Description: id value of generated VPC
    Value: !Ref Vpc
  FirstSubnetId:
    Description: id value of first generated subnet
    Value: !Ref FirstSubnet
  FirstSubnetAZ:
    Description: availability zone of first generated subnet
    Value: !GetAtt FirstSubnet.AvailabilityZone
  SecondSubnetId:
    Description: id value of second generated subnet
    Value: !Ref SecondSubnet
  SecondSubnetAZ:
    Description: availability zone of second generated subnet
    Value: !GetAtt SecondSubnet.AvailabilityZone
  ThirdSubnetId:
    Description: id value of third generated subnet
    Value: !Ref ThirdSubnet
  ThirdSubnetAZ:
    Description: availability zone of third generated subnet
    Value: !GetAtt ThirdSubnet.AvailabilityZone
  LambdaSgId:
    Description: id value of generated security group
    Value: !Ref LambdaSg