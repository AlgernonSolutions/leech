AWSTemplateFormatVersion: 2010-09-09
Transform:
  - 'AWS::Serverless-2016-10-31'
  - 'AWS::CodeStar'
Parameters:
  ProjectId:
    Type: String
    Description: CodeStar projectId used to associate new resources to team members
  LeechBucketName:
    Type: String
    Description: name to be applied to the S3 buckets generated for the leech
Resources:
  LeechBucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      BucketName: !Ref LeechBucketName
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: 'aws:kms'
      LoggingConfiguration:
        DestinationBucketName: !Ref LeechLogBucket
        LogFilePrefix: s3_logs
      LifecycleConfiguration:
        Rules:
          - Id: expire_cache
            Status: Enabled
            Prefix: cache
            NoncurrentVersionExpirationInDays: 2
            ExpirationInDays: 2
      VersioningConfiguration:
        Status: Enabled
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 4e7f7174-226a-4f80-ad85-86535d3ffceb
  LeechLogBucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      BucketName: !Join
        - '-'
        - - !Ref LeechBucketName
          - logs
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: 'aws:kms'
      VersioningConfiguration:
        Status: Enabled
    Metadata:
      'AWS::CloudFormation::Designer':
        id: e5db2f4a-844f-4381-965e-11e1a397c187
Outputs:
  LeechBucketArn:
    Description: the ARN of the bucket generated for use by the leech
    Value: !GetAtt LeechBucket.Arn
  LeechLogBucketArn:
    Description: the ARN of the bucket generated for for the logs generated by the leech
    Value: !GetAtt LeechLogBucket.Arn